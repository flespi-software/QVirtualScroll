!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("core-js/modules/es6.regexp.replace"),require("regenerator-runtime/runtime"),require("@babel/runtime/helpers/toConsumableArray"),require("@babel/runtime/helpers/asyncToGenerator"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.object.to-string"),require("core-js/modules/es6.regexp.match")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","core-js/modules/es6.regexp.replace","regenerator-runtime/runtime","@babel/runtime/helpers/toConsumableArray","@babel/runtime/helpers/asyncToGenerator","core-js/modules/es6.regexp.split","core-js/modules/es6.regexp.to-string","core-js/modules/es6.object.to-string","core-js/modules/es6.regexp.match"],t):t((e=e||self).logs={},null,null,null,e._toConsumableArray,e._asyncToGenerator)}(this,function(e,t,r,n,x,w){"use strict";x=x&&x.hasOwnProperty("default")?x.default:x,w=w&&w.hasOwnProperty("default")?w.default:w,e.default=function(e){var t=e.Vue,r=e.LocalStorage,n=e.name,s=e.errorHandler,o=e.filterHandler,i=e.newMessagesInterseptor;return{namespaced:!0,state:{name:n,isLoading:!1,origin:"",messages:[],filter:"",sysFilter:"",mode:null,from:0,to:0,cid:null,limit:1e3,reverse:!1,cols:[],newMessagesCount:0,offline:!1,selected:[],isItemDeleted:!1},actions:function(e){var d=e.Vue,i=e.LocalStorage,p=e.errorHandler,t=(new Date).toString().match(/([-\+][0-9]+)\s/)[1],a=[{name:"timestamp",width:100,display:!0,description:"Log event time",addition:"".concat(t.slice(0,3),":").concat(t.slice(3))},{name:"event_code",title:"event",width:400,display:!0,description:"Log event code and description"},{name:"ident",width:150,display:!0,description:"Connected device's identification string"},{name:"msgs",width:85,display:!0,description:"Number of messages received"},{name:"recv",width:85,display:!0,description:"Number of bytes received"},{name:"send",width:85,display:!0,description:"Number of bytes sent"},{name:"source",width:150,display:!0,description:"Connected device's address"},{name:"host",width:150,display:!0,description:"IP address from which HTTP request was received"},{name:"duration",width:85,display:!0,description:"Connection duration in seconds"},{name:"transport",width:85,display:!0,description:"Connected device's transport: tcp, udp, http etc"}];function g(e){var t={};return e.cid&&(t["x-flespi-cid"]=e.cid),t}function h(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);p&&p(t)})}function v(e,t){var r=e.split("/"),n=r.pop(),s=t||"*"===e?d.connector.http.platform.customer:r.reduce(function(e,t){return e[t]},d.connector.http);return"*"===n||t?function(e){return s.logs.get({data:JSON.stringify(e.data)},{headers:e.headers})}:function(e){return s.logs.get(n,{data:JSON.stringify(e.data)},{headers:e.headers})}}function r(){return(r=w(regeneratorRuntime.mark(function e(s){var o,i,a,c,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.state,i=s.commit,s.rootState.token&&o.origin)return e.prev=2,d.set(o,"isLoading",!0),a={data:{reverse:!0,count:1,fields:"timestamp"},headers:g(o)},(-1!==o.origin.indexOf("platform")||o.isItemDeleted)&&(a.data.filter="event_origin=".concat(o.origin)),e.next=8,v(o.origin,o.isItemDeleted)(a);e.next=22;break;case 8:c=e.sent,h(u=c.data),l=Date.now(),u.result.length&&(l=Math.round(1e3*u.result[0].timestamp)),i("setDate",(t=l,r=t||Date.now(),n=new Date(r).setHours(0,0,0,0),{from:n,to:n+864e5}).from),d.set(o,"isLoading",!1),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(2),p&&p(e.t0),DEV&&console.log(e.t0),d.set(o,"isLoading",!1);case 22:case"end":return e.stop()}var t,r,n},e,null,[[2,17]])}))).apply(this,arguments)}function y(e,t){return n.apply(this,arguments)}function n(){return(n=w(regeneratorRuntime.mark(function e(n,s){var o,i,a,c,u,l,f,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.state,i=n.commit,a=n.rootState,i("reqStart"),s&&(c=s.name,u=s.payload,i("clearMessages"),i(c,u)),a.token&&o.origin)return e.prev=4,d.set(o,"isLoading",!0),l=JSON.parse(JSON.stringify(o.mode)),e.next=9,v(o.origin,o.isItemDeleted)({data:(t=o,r=void 0,r={filter:[]},(-1!==t.origin.indexOf("platform")||t.isItemDeleted)&&r.filter.push("event_origin=".concat(t.origin)),t.limit&&(r.count=t.limit),t.filter&&t.sysFilter?(r.filter.push("".concat(t.sysFilter)),1!==t.mode&&r.filter.push("".concat(t.filter))):t.sysFilter&&!t.filter?r.filter.push("".concat(t.sysFilter)):!t.sysFilter&&t.filter&&0===t.mode&&r.filter.push("".concat(t.filter)),!t.from||t.reverse&&1!==t.mode||(t.reverse?1===t.mode&&(r.from=Math.floor(Date.now()/1e3-172800)):r.from=Math.floor(t.from/1e3)),t.to&&(1===t.mode&&(t.to=Date.now()),r.to=Math.floor(t.to/1e3)),t.reverse&&(r.reverse=t.reverse),r.filter.length?r.filter=r.filter.join(","):delete r.filter,r),headers:g(o)});e.next=46;break;case 9:if(f=e.sent,l!==o.mode)return e.abrupt("return",!1);e.next=12;break;case 12:if(h(m=f.data),!s){e.next=37;break}if(!m.result.length){e.next=20;break}i("setMessages",m.result),i("postaction"),e.next=35;break;case 20:i("postaction"),e.t0=s.name,e.next="paginationPrev"===e.t0?24:"paginationNext"===e.t0?30:33;break;case 24:return i("datePrev"),i("paginationPrev"),e.next=28,y({state:o,commit:i,rootState:a});case 28:return i("postaction"),e.abrupt("break",35);case 30:return y({state:o,commit:i,rootState:a},{name:"dateNext"}),i("postaction"),e.abrupt("break",35);case 33:i("setMessages",m.result),i("postaction");case 35:e.next=38;break;case 37:i("setMessages",m.result);case 38:d.set(o,"isLoading",!1),e.next=46;break;case 41:e.prev=41,e.t1=e.catch(4),p&&p(e.t1),DEV&&console.log(e.t1),d.set(o,"isLoading",!1);case 46:case"end":return e.stop()}var t,r},e,null,[[4,41]])}))).apply(this,arguments)}function s(){return(s=w(regeneratorRuntime.mark(function e(t,r){var n,s,o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.state,s=t.commit,o=t.rootState,i=n.limit,a=n.filter,s("setReverse",!0),s("setLimit",r),s("setFilter",""),e.next=7,y({state:n,commit:s,rootState:o});case 7:s("setReverse",!1),s("setLimit",i),s("setFilter",a);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}var c=[],u=0;function l(e,t){return setInterval(function(){c.length&&(1===e.mode&&t("setMessages",x(c)),c=[])},500)}function o(){return(o=w(regeneratorRuntime.mark(function e(t){var r,n,s,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=t.commit,t.rootState,s=r.origin.split("/")[0].replace(/\*/g,"+"),o=r.origin.replace("".concat(s,"/"),"").replace(/\*/g,"+"),u=l(r,n),i={},r.cid&&(i={userProperties:{cid:r.cid}}),e.next=7,d.connector.subscribeLogs(s,o,"#",function(e){1===r.mode?c.push(JSON.parse(e)):n("setNewMessagesCount",r.newMessagesCount+1)},{rh:2,properties:i});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(){return(f=w(regeneratorRuntime.mark(function e(t){var r,n,s,o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,t.rootState.token&&r.origin)return e.prev=2,d.set(r,"isLoading",!0),s=r.messages.reduceRight(function(e,t,r){return e||("offline"===t.__connectionStatus&&(e=r),e)},0),o={data:{from:s?Math.floor(r.messages[s-1].timestamp)+1:0,to:Math.floor(r.messages[s+1].timestamp)},headers:g(r)},-1!==r.origin.indexOf("platform")&&(o.data.filter="event_origin=".concat(r.origin)),e.next=9,v(r.origin,r.isItemDeleted)(o);e.next=21;break;case 9:i=e.sent,h(a=i.data),n("setMissingMessages",{data:a.result,index:s}),d.set(r,"isLoading",!1),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(2),p&&p(e.t0),DEV&&console.log(e.t0),d.set(r,"isLoading",!1);case 21:case"end":return e.stop()}},e,null,[[2,16]])}))).apply(this,arguments)}function m(){return(m=w(regeneratorRuntime.mark(function e(t){var r,n,s,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=r.origin.split("/")[0].replace(/\*/g,"+"),s=r.origin.replace("".concat(n,"/"),"").replace(/\*/g,"+"),console.log(),u&&clearInterval(u),o={},r.cid&&(o={userProperties:{cid:r.cid}}),e.next=8,d.connector.unsubscribeLogs(n,s,"#",void 0,{properties:o});case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{get:y,pollingGet:function(e){return o.apply(this,arguments)},getHistory:function(e,t){return s.apply(this,arguments)},initTime:function(e){return r.apply(this,arguments)},getCols:function(e,t){var r=e.state,n=e.commit,s=(e.rootState,t||a),o=i.get.item(r.name);o&&o[r.origin]&&o[r.origin].length&&(o[r.origin].forEach(function(e){if("timestamp"===e.name){var t=(new Date).toString().match(/([-\+][0-9]+)\s/)[1];e.addition="".concat(t.slice(0,3),":").concat(t.slice(3))}}),s=o[r.origin]),n("setCols",s)},unsubscribePooling:function(e){return m.apply(this,arguments)},getMissedMessages:function(e){return f.apply(this,arguments)}}}({Vue:t,LocalStorage:r,errorHandler:s}),mutations:function(e){var s=e.Vue,n=e.LocalStorage,o=e.filterHandler,i=e.newMessagesInterseptor;function a(e){var t=e||Date.now(),r=new Date(t).setHours(0,0,0,0);return{from:r,to:r+864e5}}function r(e,t){if(t&&t.length){e.reverse&&(t.reverse(),1===e.mode&&(t[t.length-1].delimiter=!0)),1===e.mode&&(s.set(e,"from",Math.floor(1e3*(t[t.length-1].timestamp+1))),e.filter&&o&&(t=o(e.filter,t))),i&&i(t);var r=e.messages.concat(t);if(e.limit&&1===e.mode&&r.length>=e.limit+.1*e.limit){var n=r.length-1-(e.limit-1);r=r.slice(n),s.set(e,"selected",e.selected.map(function(e){return e-n}))}s.set(e,"messages",r)}else 1===e.mode&&s.set(e,"from",e.to+1e3),s.set(e,"messages",[])}function c(e){i&&i([]),s.set(e,"messages",[]),p(e)}function u(e,t){s.set(e,"from",t)}function l(e,t){s.set(e,"to",t)}function f(e,t){s.set(e,"reverse",t)}function m(e,t){e.sysFilter?e.sysFilter+=",".concat(t):e.sysFilter=t}function t(){return(t=w(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.origin.split("/")[0],n=t.origin.replace("".concat(r,"/"),"").replace(/\*/g,"+"),c(t),t.filter="",t.mode=null,t.from=0,t.to=0,t.limit=1e3,t.reverse=!1,e.next=10,s.connector.unsubscribeLogs(r,n,"#");case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d(e,t){var r=n.get.item(e.name);r||(r={}),r[e.origin]=t,n.set(e.name,r),s.set(e,"cols",t)}function p(e){s.set(e,"selected",[])}return{setOffline:function(e,t){t&&r(e,[{__connectionStatus:"offline",timestamp:Date.now()/1e3}]),e.offline=!0},setReconnected:function(e,t){t&&r(e,[{__connectionStatus:"reconnected",timestamp:Date.now()/1e3}]),e.offline=!1},setMessages:r,clearMessages:c,setLimit:function(e,t){s.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&(1===e.mode&&(e.filter&&e.messages.push({"x-flespi-filter-prev":e.filter}),t&&e.messages.push({"x-flespi-filter-next":t})),s.set(e,"filter",t))},setMode:function(e,t){switch(t){case 0:var r=e.from?a(e.from):a();e.from=r.from,e.to=r.to,c(e);break;case 1:var n=Date.now()-6e3;e.from=n-1e3,e.to=n,e.newMessagesCount=0}s.set(e,"mode",t)},setFrom:u,setTo:l,reqStart:function(){DEV&&console.log("Start Request Logs")},setReverse:f,dateNext:function(e){var t=a(e.from+864e5);e.from=t.from,e.to=t.to},datePrev:function(e){var t=a(e.from-864e5);e.from=t.from,e.to=t.to},paginationPrev:function(e,t){e.reverse=!0,m(e,"timestamp>=".concat(a(e.from).from/1e3)),t&&(e.from=a(t).from,e.to=t-1e3)},paginationNext:function(e,t){m(e,"timestamp<=".concat(e.to/1e3)),t&&(e.to=a(t).to,e.from=t+1e3)},setDate:function(e,t){var r=a(t);e.from=r.from,e.to=r.to},postaction:function(e){var t=a(e.from);u(e,e.from||t.from),l(e,t.to),e.reverse&&f(e,!1);var r=e.sysFilter.indexOf("timestamp"),n=function(t,r){return function(e){return"".concat(t?e.slice(0,t):"").concat(r?e.slice(r):"")}};if(0===r){var s=e.sysFilter.indexOf(",",r);e.sysFilter=-1!==s?n(0,s+1)(e.sysFilter):""}else if(0<r){var o=e.sysFilter.indexOf(",",r);e.sysFilter=-1!==o?n(r,o+1)(e.sysFilter):n(r-1)(e.sysFilter)}},clear:function(e){return t.apply(this,arguments)},setOrigin:function(e,t){e.newMessagesCount=0,s.set(e,"origin",t)},setSysFilter:m,setCols:d,updateCols:d,setNewMessagesCount:function(e,t){s.set(e,"newMessagesCount",t)},setMissingMessages:function(e,t){var r,n=t.data,s=t.index;n.forEach(function(e){e.__status="missed"}),(r=e.messages).splice.apply(r,[s+1,0].concat(x(n)))},setSelected:function(e,t){s.set(e,"selected",t)},clearSelected:p,setItemDeletedStatus:function(e,t){s.set(e,"isItemDeleted",t)},setCid:function(e,t){s.set(e,"cid",t)}}}({Vue:t,LocalStorage:r,filterHandler:o,newMessagesInterseptor:i})}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=logs.js.map
