!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("core-js/modules/es6.regexp.replace"),require("core-js/library/fn/array/is-array"),require("core-js/library/fn/array/from"),require("core-js/library/fn/is-iterable"),require("@babel/runtime-corejs2/regenerator"),require("regenerator-runtime/runtime"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.object.to-string"),require("core-js/modules/es6.regexp.match")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","core-js/modules/es6.regexp.replace","core-js/library/fn/array/is-array","core-js/library/fn/array/from","core-js/library/fn/is-iterable","@babel/runtime-corejs2/regenerator","regenerator-runtime/runtime","core-js/modules/es6.regexp.split","core-js/modules/es6.regexp.to-string","core-js/modules/es6.object.to-string","core-js/modules/es6.regexp.match"],t):t((e=e||self).logs={},null,null,e.isArray$1,e.from,e.isIterable$1,e._regeneratorRuntime)}(this,function(e,t,r,s,n,o,w){"use strict";s=s&&s.hasOwnProperty("default")?s.default:s,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,w=w&&w.hasOwnProperty("default")?w.default:w;var i=s;var a=function(e){if(i(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}},c=n,l=o;var u=function(e){if(l(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return c(e)};var f=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var x=function(e){return a(e)||u(e)||f()};function d(e){var m=e.Vue,i=e.LocalStorage,p=e.errorHandler,t=(new Date).toString().match(/([-\+][0-9]+)\s/)[1],a=[{name:"timestamp",width:100,display:!0,description:"Log event time",addition:"".concat(t.slice(0,3),":").concat(t.slice(3))},{name:"event_code",title:"event",width:400,display:!0,description:"Log event code and description"},{name:"ident",width:150,display:!0,description:"Connected device's identification string"},{name:"msgs",width:85,display:!0,description:"Number of messages received"},{name:"recv",width:85,display:!0,description:"Number of bytes received"},{name:"send",width:85,display:!0,description:"Number of bytes sent"},{name:"source",width:150,display:!0,description:"Connected device's address"},{name:"host",width:150,display:!0,description:"IP address from which HTTP request was received"},{name:"duration",width:85,display:!0,description:"Connection duration in seconds"},{name:"transport",width:85,display:!0,description:"Connected device's transport: tcp, udp, http etc"}];function g(e){var t={};return e.cid&&(t["x-flespi-cid"]=e.cid),t}function v(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);p&&p(t)})}function h(e,t){var r=e.split("/"),s=r.pop(),n=t||"*"===e?m.connector.http.platform.customer:r.reduce(function(e,t){return e[t]},m.connector.http);return"*"===s||t?function(e){return n.logs.get({data:JSON.stringify(e.data)},{headers:e.headers})}:function(e){return n.logs.get(s,{data:JSON.stringify(e.data)},{headers:e.headers})}}function y(s,n){var o,i,a,c,l,u,f,d;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.state,i=s.commit,a=s.rootState,i("reqStart"),n&&(c=n.name,l=n.payload,i("clearMessages"),i(c,l)),a.token&&o.origin)return e.prev=4,m.set(o,"isLoading",!0),u=JSON.parse(JSON.stringify(o.mode)),e.next=9,w.awrap(h(o.origin,o.isItemDeleted)({data:(t=o,r=void 0,r={filter:[]},-1===t.origin.indexOf("platform")&&!t.isItemDeleted||r.filter.push("event_origin=".concat(t.origin)),t.limit&&(r.count=t.limit),t.filter&&t.sysFilter?(r.filter.push("".concat(t.sysFilter)),1!==t.mode&&r.filter.push("".concat(t.filter))):t.sysFilter&&!t.filter?r.filter.push("".concat(t.sysFilter)):!t.sysFilter&&t.filter&&0===t.mode&&r.filter.push("".concat(t.filter)),!t.from||t.reverse&&1!==t.mode||(t.reverse?1===t.mode&&(r.from=Math.floor(Date.now()/1e3-172800)):r.from=Math.floor(t.from/1e3)),t.to&&(1===t.mode&&(t.to=Date.now()),r.to=Math.floor(t.to/1e3)),t.reverse&&(r.reverse=t.reverse),r.filter.length?r.filter=r.filter.join(","):delete r.filter,r),headers:g(o)}));e.next=46;break;case 9:if(f=e.sent,u!==o.mode)return e.abrupt("return",!1);e.next=12;break;case 12:if(v(d=f.data),!n){e.next=37;break}if(!d.result.length){e.next=20;break}i("setMessages",d.result),i("postaction"),e.next=35;break;case 20:i("postaction"),e.t0=n.name,e.next="paginationPrev"===e.t0?24:"paginationNext"===e.t0?30:33;break;case 24:return i("datePrev"),i("paginationPrev"),e.next=28,w.awrap(y({state:o,commit:i,rootState:a}));case 28:return i("postaction"),e.abrupt("break",35);case 30:return y({state:o,commit:i,rootState:a},{name:"dateNext"}),i("postaction"),e.abrupt("break",35);case 33:i("setMessages",d.result),i("postaction");case 35:e.next=38;break;case 37:i("setMessages",d.result);case 38:m.set(o,"isLoading",!1),e.next=46;break;case 41:e.prev=41,e.t1=e.catch(4),p&&p(e.t1),DEV&&console.log(e.t1),m.set(o,"isLoading",!1);case 46:case"end":return e.stop()}var t,r},null,null,[[4,41]])}var c=[],l=0;function u(e,t){return setInterval(function(){c.length&&(1===e.mode&&t("setMessages",x(c)),c=[])},500)}return{get:y,pollingGet:function(t){var r,s,n,o,i;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,s=t.commit,t.rootState,n=r.origin.split("/")[0].replace(/\*/g,"+"),o=r.origin.replace("".concat(n,"/"),"").replace(/\*/g,"+"),l=u(r,s),i={},r.cid&&(i={userProperties:{cid:r.cid}}),e.next=7,w.awrap(m.connector.subscribeLogs(n,o,"#",function(e){1===r.mode?c.push(JSON.parse(e)):s("setNewMessagesCount",r.newMessagesCount+1)},{rh:2,properties:i}));case 7:case"end":return e.stop()}})},getHistory:function(t,r){var s,n,o,i,a;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.state,n=t.commit,o=t.rootState,i=s.limit,a=s.filter,n("setReverse",!0),n("setLimit",r),n("setFilter",""),e.next=7,w.awrap(y({state:s,commit:n,rootState:o}));case 7:n("setReverse",!1),n("setLimit",i),n("setFilter",a);case 10:case"end":return e.stop()}})},initTime:function(s){var n,o,i,a,c,l;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.state,o=s.commit,s.rootState.token&&n.origin)return e.prev=2,m.set(n,"isLoading",!0),i={data:{reverse:!0,count:1,fields:"timestamp"},headers:g(n)},-1===n.origin.indexOf("platform")&&!n.isItemDeleted||(i.data.filter="event_origin=".concat(n.origin)),e.next=8,w.awrap(h(n.origin,n.isItemDeleted)(i));e.next=22;break;case 8:a=e.sent,v(c=a.data),l=Date.now(),c.result.length&&(l=Math.round(1e3*c.result[0].timestamp)),o("setDate",(void 0,t=l||Date.now(),{from:r=new Date(t).setHours(0,0,0,0),to:r+864e5}).from),m.set(n,"isLoading",!1),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(2),p&&p(e.t0),DEV&&console.log(e.t0),m.set(n,"isLoading",!1);case 22:case"end":return e.stop()}var t,r},null,null,[[2,17]])},getCols:function(e,t){var r=e.state,s=e.commit,n=(e.rootState,t||a),o=i.getItem(r.name);o&&o[r.origin]&&o[r.origin].length&&(o[r.origin].forEach(function(e){if("timestamp"===e.name){var t=(new Date).toString().match(/([-\+][0-9]+)\s/)[1];e.addition="".concat(t.slice(0,3),":").concat(t.slice(3))}}),n=o[r.origin]),s("setCols",n)},unsubscribePooling:function(t){var r,s,n,o;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,s=r.origin.split("/")[0].replace(/\*/g,"+"),n=r.origin.replace("".concat(s,"/"),"").replace(/\*/g,"+"),console.log(),l&&clearInterval(l),o={},r.cid&&(o={userProperties:{cid:r.cid}}),e.next=8,w.awrap(m.connector.unsubscribeLogs(s,n,"#",void 0,{properties:o}));case 8:case"end":return e.stop()}})},getMissedMessages:function(t){var r,s,n,o,i,a;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,s=t.commit,t.rootState.token&&r.origin)return e.prev=2,m.set(r,"isLoading",!0),n=r.messages.reduceRight(function(e,t,r){return e||("offline"===t.__connectionStatus&&(e=r),e)},0),o={data:{from:n?Math.floor(r.messages[n-1].timestamp)+1:0,to:Math.floor(r.messages[n+1].timestamp)},headers:g(r)},-1!==r.origin.indexOf("platform")&&(o.data.filter="event_origin=".concat(r.origin)),e.next=9,w.awrap(h(r.origin,r.isItemDeleted)(o));e.next=21;break;case 9:i=e.sent,v(a=i.data),s("setMissingMessages",{data:a.result,index:n}),m.set(r,"isLoading",!1),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(2),p&&p(e.t0),DEV&&console.log(e.t0),m.set(r,"isLoading",!1);case 21:case"end":return e.stop()}},null,null,[[2,16]])}}}function m(e){var n=e.Vue,s=e.LocalStorage,o=e.filterHandler,i=e.newMessagesInterseptor;function a(e){var t=e||Date.now(),r=new Date(t).setHours(0,0,0,0);return{from:r,to:r+864e5}}function r(e,t){if(t&&t.length){e.reverse&&(t.reverse(),1===e.mode&&(t[t.length-1].delimiter=!0)),1===e.mode&&(n.set(e,"from",Math.floor(1e3*(t[t.length-1].timestamp+1))),e.filter&&o&&(t=o(e.filter,t))),i&&i(t);var r=e.messages.concat(t);if(e.limit&&1===e.mode&&r.length>=e.limit+.1*e.limit){var s=r.length-1-(e.limit-1);r=r.slice(s),n.set(e,"selected",e.selected.map(function(e){return e-s}))}n.set(e,"messages",r)}else 1===e.mode&&n.set(e,"from",e.to+1e3),n.set(e,"messages",[])}function c(e){i&&i([]),n.set(e,"messages",[]),m(e)}function l(e,t){n.set(e,"from",t)}function u(e,t){n.set(e,"to",t)}function f(e,t){n.set(e,"reverse",t)}function d(e,t){e.sysFilter?e.sysFilter+=",".concat(t):e.sysFilter=t}function t(e,t){var r=s.getItem(e.name);(r=r||{})[e.origin]=t,s.set(e.name,r),n.set(e,"cols",t)}function m(e){n.set(e,"selected",[])}return{setOffline:function(e,t){t&&r(e,[{__connectionStatus:"offline",timestamp:Date.now()/1e3}]),e.offline=!0},setReconnected:function(e,t){t&&r(e,[{__connectionStatus:"reconnected",timestamp:Date.now()/1e3}]),e.offline=!1},setMessages:r,clearMessages:c,setLimit:function(e,t){n.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&(1===e.mode&&(e.filter&&e.messages.push({"x-flespi-filter-prev":e.filter}),t&&e.messages.push({"x-flespi-filter-next":t})),n.set(e,"filter",t))},setMode:function(e,t){switch(t){case 0:var r=e.from?a(e.from):a();e.from=r.from,e.to=r.to,c(e);break;case 1:var s=Date.now()-6e3;e.from=s-1e3,e.to=s,e.newMessagesCount=0}n.set(e,"mode",t)},setFrom:l,setTo:u,reqStart:function(){DEV&&console.log("Start Request Logs")},setReverse:f,dateNext:function(e){var t=a(e.from+864e5);e.from=t.from,e.to=t.to},datePrev:function(e){var t=a(e.from-864e5);e.from=t.from,e.to=t.to},paginationPrev:function(e,t){e.reverse=!0,d(e,"timestamp>=".concat(a(e.from).from/1e3)),t&&(e.from=a(t).from,e.to=t-1e3)},paginationNext:function(e,t){d(e,"timestamp<=".concat(e.to/1e3)),t&&(e.to=a(t).to,e.from=t+1e3)},setDate:function(e,t){var r=a(t);e.from=r.from,e.to=r.to},postaction:function(e){var t=a(e.from);function r(t,r){return function(e){return"".concat(t?e.slice(0,t):"").concat(r?e.slice(r):"")}}l(e,e.from||t.from),u(e,t.to),e.reverse&&f(e,!1);var s=e.sysFilter.indexOf("timestamp");if(0===s){var n=e.sysFilter.indexOf(",",s);e.sysFilter=-1!==n?r(0,n+1)(e.sysFilter):""}else if(0<s){var o=e.sysFilter.indexOf(",",s);e.sysFilter=-1!==o?r(s,o+1)(e.sysFilter):r(s-1)(e.sysFilter)}},clear:function(t){var r,s;return w.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.origin.split("/")[0],s=t.origin.replace("".concat(r,"/"),"").replace(/\*/g,"+"),c(t),t.filter="",t.mode=null,t.from=0,t.to=0,t.limit=1e3,t.reverse=!1,e.next=10,w.awrap(n.connector.unsubscribeLogs(r,s,"#"));case 10:case"end":return e.stop()}})},setOrigin:function(e,t){e.newMessagesCount=0,n.set(e,"origin",t)},setSysFilter:d,setCols:t,updateCols:t,setNewMessagesCount:function(e,t){n.set(e,"newMessagesCount",t)},setMissingMessages:function(e,t){var r,s=t.data,n=t.index;s.forEach(function(e){e.__status="missed"}),(r=e.messages).splice.apply(r,[n+1,0].concat(x(s)))},setSelected:function(e,t){n.set(e,"selected",t)},clearSelected:m,setItemDeletedStatus:function(e,t){n.set(e,"isItemDeleted",t)},setCid:function(e,t){n.set(e,"cid",t)}}}e.default=function(e){var t=e.Vue,r=e.LocalStorage,s=e.name,n=e.errorHandler,o=e.filterHandler,i=e.newMessagesInterseptor;return{namespaced:!0,state:{name:s,isLoading:!1,origin:"",messages:[],filter:"",sysFilter:"",mode:null,from:0,to:0,cid:null,limit:1e3,reverse:!1,cols:[],newMessagesCount:0,offline:!1,selected:[],isItemDeleted:!1},actions:d({Vue:t,LocalStorage:r,errorHandler:n}),mutations:m({Vue:t,LocalStorage:r,filterHandler:o,newMessagesInterseptor:i})}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=logs.js.map
