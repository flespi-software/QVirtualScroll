!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("core-js/modules/es6.regexp.replace"),require("@babel/runtime-corejs2/regenerator"),require("regenerator-runtime/runtime"),require("core-js/library/fn/array/is-array"),require("core-js/library/fn/array/from"),require("core-js/library/fn/is-iterable"),require("core-js/library/fn/promise"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.object.to-string"),require("core-js/modules/es6.regexp.match"),require("lodash/get")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","core-js/modules/es6.regexp.replace","@babel/runtime-corejs2/regenerator","regenerator-runtime/runtime","core-js/library/fn/array/is-array","core-js/library/fn/array/from","core-js/library/fn/is-iterable","core-js/library/fn/promise","core-js/modules/es6.regexp.split","core-js/modules/es6.regexp.to-string","core-js/modules/es6.object.to-string","core-js/modules/es6.regexp.match","lodash/get"],t):t((e=e||self).logs={},0,0,e._regeneratorRuntime,0,e.isArray$1,e.from,e.isIterable$1,e.promise$1,0,0,0,0,e._get)}(this,function(e,t,r,k,n,s,i,a,o,c,l,u,p,L){"use strict";k=k&&k.hasOwnProperty("default")?k.default:k,s=s&&s.hasOwnProperty("default")?s.default:s,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,o=o&&o.hasOwnProperty("default")?o.default:o,L=L&&L.hasOwnProperty("default")?L.default:L;var f=s;var d=function(e){if(f(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}},m=i,g=a;var h=function(e){if(g(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return m(e)};var v=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var M=function(e){return d(e)||h(e)||v()},y=o;function b(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):y.resolve(c).then(n,s)}var j=function(o){return function(){var e=this,a=arguments;return new y(function(t,r){var n=o.apply(e,a);function s(e){b(n,t,r,s,i,"next",e)}function i(e){b(n,t,r,s,i,"throw",e)}s(void 0)})}},x=(new Date).toString().match(/([-+][0-9]+)\s/)[1],D=[{name:"timestamp",width:100,display:!0,description:"Log event time",addition:"".concat(x.slice(0,3),":").concat(x.slice(3))},{name:"event_code",title:"event",width:400,display:!0,description:"Log event code and description"},{name:"ident",width:150,display:!0,description:"Connected device's identification string"},{name:"msgs",width:85,display:!0,description:"Number of messages received"},{name:"recv",width:85,display:!0,description:"Number of bytes received"},{name:"send",width:85,display:!0,description:"Number of bytes sent"},{name:"source",width:150,display:!0,description:"Connected device's address"},{name:"host",width:150,display:!0,description:"IP address from which HTTP request was received"},{name:"duration",width:85,display:!0,description:"Connection duration in seconds"},{name:"transport",width:85,display:!0,description:"Connected device's transport: tcp, udp, http etc"},{name:"etc",width:150,display:!0,__dest:"etc"}];function w(e){var g=e.Vue,a=e.LocalStorage,p=e.errorHandler;function h(e){var t={filter:[]};return-1===e.origin.indexOf("platform")&&!e.isItemDeleted||t.filter.push("event_origin=".concat(e.origin)),e.limit&&(t.count=e.limit),e.filter&&t.filter.push("".concat(e.filter)),e.from&&(t.from=Math.floor(e.from/1e3)),e.to&&(t.to=Math.floor(e.to/1e3)),e.reverse&&(t.reverse=e.reverse),t.filter.length?t.filter=t.filter.join(","):delete t.filter,t}function f(e){var t={};return e.cid&&(t["x-flespi-cid"]=e.cid),t}function d(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);p&&p(t)})}function m(e,t){var r=e.split("/"),n=r.pop(),s=t||"*"===e?g.connector.http.platform.customer:r.reduce(function(e,t){return e[t]},g.connector.http);return"*"===n||t?function(e){return s.logs.get({data:JSON.stringify(e.data)},{headers:e.headers})}:function(e){return s.logs.get(n,{data:JSON.stringify(e.data)},{headers:e.headers})}}function t(){return(t=j(k.mark(function e(n){var s,i,a,o,c,l,u;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.state,i=n.commit,n.rootState.token&&s.origin)return e.prev=2,g.set(s,"isLoading",!0),a={data:{reverse:!0,count:1,fields:"timestamp"},headers:f(s)},-1===s.origin.indexOf("platform")&&!s.isItemDeleted||(a.data.filter="event_origin=".concat(s.origin)),e.next=8,m(s.origin,s.isItemDeleted)(a);e.next=24;break;case 8:o=e.sent,d(c=o.data),l=Date.now(),c.result.length&&(l=Math.round(1e3*c.result[0].timestamp)),0,t=l||Date.now(),r=new Date(t).setHours(0,0,0,0),i("setFrom",(u={from:r,to:r+86399999}).from),i("setTo",u.to),g.set(s,"isLoading",!1),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(2),p&&p(e.t0),DEV&&console.log(e.t0),g.set(s,"isLoading",!1);case 24:case"end":return e.stop()}var t,r},e,null,[[2,19]])}))).apply(this,arguments)}function v(e,t){return r.apply(this,arguments)}function r(){return(r=j(k.mark(function e(t,r){var n,s,i,a,o,c,l;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,s=t.commit,i=t.rootState,s("reqStart"),a=[],i.token&&n.origin)return o=n.isLoading,e.prev=5,o||g.set(n,"isLoading",!0),e.next=9,m(n.origin,n.isItemDeleted)({data:r,headers:f(n)});e.next=21;break;case 9:c=e.sent,d(l=c.data),o||g.set(n,"isLoading",!1),a=l.result||[],e.next=21;break;case 16:e.prev=16,e.t0=e.catch(5),p&&p(e.t0),DEV&&console.log(e.t0),o||g.set(n,"isLoading",!1);case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}},e,null,[[5,16]])}))).apply(this,arguments)}function o(e){return n.apply(this,arguments)}function n(){return(n=j(k.mark(function e(t){var r,n,s,i,a,o,c,l,u,p,f,d,m;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,s=t.rootState,r.isLoading){e.next=35;break}return g.set(r,"isLoading",!0),i=Math.floor(Date.now()/1e3),a=h(r),o=0,e.next=8,v({state:r,commit:n,rootState:s},a);case 8:if(c=e.sent,o+=c.length,l=Math.floor(Date.now()/1e3),u=a.to>=l&&r.limit&&c.length<r.limit&&!y,p=function(){},u)return e.next=16,b({state:r,commit:n,rootState:s});e.next=28;break;case 16:return p=e.sent,f=Math.floor(Date.now()/1e3),(d=h(r)).from=i,d.to=f,e.next=23,v({state:r,commit:n,rootState:s},d);case 23:m=e.sent,o+=m.length,c.splice.apply(c,[c.length,0].concat(M(m))),e.next=31;break;case 28:if((a.to<l||r.limit&&c.length>=r.limit)&&y)return e.next=31,w({state:r,commit:n,rootState:s});e.next=31;break;case 31:n("limiting",{type:"init",count:o}),n("setHistoryMessages",c),(u||r.realtimeEnabled)&&(p(),n("limiting",{type:"rt_init"})),g.set(r,"isLoading",!1);case 35:case"end":return e.stop()}},e)}))).apply(this,arguments)}function s(){return(s=j(k.mark(function e(t,r){var n,s,i,a;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.state,s=t.commit,i=t.rootState,a=n.limit,s("clearMessages"),s("setReverse",!0),s("setLimit",r),e.next=7,o({state:n,commit:s,rootState:i});case 7:s("setReverse",!1),s("setLimit",a);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function i(){return(i=j(k.mark(function e(t){var r,n,s,i,a,o;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,s=t.rootState,r.isLoading){e.next=21;break}if(g.set(r,"isLoading",!0),i=Math.floor(L(r,"messages[0].timestamp",r.to)-1),(a=h(r)).to=i,a.reverse=!0,y&&r.messages.length>2*r.limit)return e.next=10,w({state:r,commit:n,rootState:s});e.next=11;break;case 10:n("limiting",{type:"rt_deinit"});case 11:return e.next=13,v({state:r,commit:n,rootState:s},a);case 13:if((o=e.sent).length){e.next=17;break}return g.set(r,"isLoading",!1),e.abrupt("return",0);case 17:return n("limiting",{type:"prev",count:o.length}),n("prependMessages",o),g.set(r,"isLoading",!1),e.abrupt("return",o.length);case 21:case"end":return e.stop()}},e)}))).apply(this,arguments)}function c(){return(c=j(k.mark(function e(t){var r,n,s,i,a,o,c,l,u,p,f,d,m;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,s=t.rootState,r.isLoading){e.next=34;break}if(r.realtimeEnabled)return e.abrupt("return");e.next=4;break;case 4:return g.set(r,"isLoading",!0),i=Date.now(),a=Math.floor(L(r,"messages[".concat(r.messages.length-1,"].timestamp"),r.from)+1),o=h(r),c=0,o.from=a,e.next=12,v({state:r,commit:n,rootState:s},o);case 12:if(l=e.sent,c+=l.length,u=o.to>Math.floor(Date.now()/1e3)&&r.limit&&l.length<r.limit&&!y,p=function(){},u)return e.next=19,b({state:r,commit:n,rootState:s});e.next=29;break;case 19:return p=e.sent,f=Date.now(),(d=h(r)).from=Math.floor(i/1e3),d.to=Math.floor(f/1e3),e.next=26,v({state:r,commit:n,rootState:s},d);case 26:m=e.sent,c+=m.length,l.splice.apply(l,[l.length,0].concat(M(m)));case 29:return n("limiting",{type:"next",count:c}),n("appendMessages",l),u&&(p(),n("limiting",{type:"rt_init"})),g.set(r,"isLoading",!1),e.abrupt("return",c);case 34:case"end":return e.stop()}},e)}))).apply(this,arguments)}var l=[],y=0;function b(e){return u.apply(this,arguments)}function u(){return(u=j(k.mark(function e(t){var r,n,s,i,a;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=t.commit,t.rootState,s=r.origin.split("/")[0].replace(/\*/g,"+"),i=r.origin.replace("".concat(s,"/"),"").replace(/\*/g,"+"),a={},r.cid&&(a={userProperties:{cid:r.cid}}),e.next=6,g.connector.subscribeLogs(s,i,"#",function(e){l.push(JSON.parse(e))},{rh:2,properties:a});case 6:return r.realtimeEnabled=!0,e.abrupt("return",function(){var e;e=n,y=setInterval(function(){l.length&&(e("setRTMessages",M(l)),l=[])},500)});case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(){return(x=j(k.mark(function e(t){var r,n,s,i,a,o;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,t.rootState.token&&r.origin)return e.prev=2,g.set(r,"isLoading",!0),s=r.messages.reduceRight(function(e,t,r){return e||("offline"===t.__connectionStatus&&(e=r),e)},0),i={data:{from:s?Math.floor(r.messages[s-1].timestamp)+1:0,to:Math.floor(r.messages[s+1].timestamp)},headers:f(r)},-1!==r.origin.indexOf("platform")&&(i.data.filter="event_origin=".concat(r.origin)),e.next=9,m(r.origin,r.isItemDeleted)(i);e.next=21;break;case 9:a=e.sent,d(o=a.data),n("setMissingMessages",{data:o.result,index:s}),g.set(r,"isLoading",!1),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(2),p&&p(e.t0),DEV&&console.log(e.t0),g.set(r,"isLoading",!1);case 21:case"end":return e.stop()}},e,null,[[2,16]])}))).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=j(k.mark(function e(t){var r,n,s,i;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=r.origin.split("/")[0].replace(/\*/g,"+"),s=r.origin.replace("".concat(n,"/"),"").replace(/\*/g,"+"),y&&(clearInterval(y),l=[],y=0),i={},r.cid&&(i={userProperties:{cid:r.cid}}),e.next=7,g.connector.unsubscribeLogs(n,s,"#",void 0,{properties:i});case 7:r.realtimeEnabled=!1;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{getLogs:v,get:o,getPrevPage:function(e){return i.apply(this,arguments)},getNextPage:function(e){return c.apply(this,arguments)},pollingGet:b,getHistory:function(e,t){return s.apply(this,arguments)},initTime:function(e){return t.apply(this,arguments)},getCols:function(e,t){var r=e.state,n=e.commit,s=(e.rootState,t||D),i=a.getItem(r.name);i&&i[r.origin]&&i[r.origin].length&&(i[r.origin].forEach(function(e){if("timestamp"===e.name){var t=(new Date).toString().match(/([-+][0-9]+)\s/)[1];e.addition="".concat(t.slice(0,3),":").concat(t.slice(3))}}),s=i[r.origin]),s[s.length-1].__dest||s.push({name:"etc",width:150,display:!0,__dest:"etc"}),n("setCols",s)},unsubscribePooling:w,getMissedMessages:function(e){return x.apply(this,arguments)}}}function S(e){var s=e.Vue,n=e.LocalStorage,i=e.filterHandler,a=e.newMessagesInterseptor,o=0;function c(r){r.length&&r.forEach(function(e,t){r[t]["x-flespi-message-key"]=o++})}function l(e){e.messages.splice(0,e.messages.length),a&&a([]),p(e)}function u(e,t){var r=t.type,n=t.count;if(!e.limit)return!1;var s=e.messages,i=e.pages;switch(r){case"init":e.pages=n?[n]:[];break;case"prev":if(!n)break;if(3===i.length){var a=i[2];e.pages=[n].concat(M(i.slice(0,-1))),s.splice(s.length-a,a)}else e.pages=[n].concat(M(i));break;case"next":if(!n)break;var o=i.length;if(3===o){var c=i[0];e.pages=[].concat(M(i.slice(1,3)),[n]),s.splice(0,c)}else o<3&&i.push(n);break;case"rt_init":i.push(0);break;case"rt_deinit":var l=i.pop();s.splice(s.length-l,l);break;case"rt":var u=i.length,p=i[u-1]||0;if(p+n>e.limit)if(3<u){var f=i[0];e.pages=[].concat(M(i.slice(1,-1)),[p+n,0]),s.splice(0,f)}else e.pages=[].concat(M(i.slice(0,-1)),[p+n,0]);else e.pages[u-1]=p+n}}function t(){return(t=j(k.mark(function e(t){var r,n;return k.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.origin.split("/")[0],n=t.origin.replace("".concat(r,"/"),"").replace(/\*/g,"+"),l(t),t.filter="",t.from=0,t.to=0,t.limit=1e3,t.reverse=!1,e.next=9,s.connector.unsubscribeLogs(r,n,"#");case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function r(e,t){var r=n.getItem(e.name);(r=r||{})[e.origin]=t,n.set(e.name,r),s.set(e,"cols",t)}function p(e){s.set(e,"selected",[])}return{setOffline:function(e,t){t&&e.messages.push({__connectionStatus:"offline",timestamp:Date.now()/1e3}),e.offline=!0},setReconnected:function(e,t){t&&e.messages.push({__connectionStatus:"reconnected",timestamp:Date.now()/1e3}),e.offline=!1},setHistoryMessages:function(e,t){e.reverse&&t.reverse(),c(t),a&&a(t),e.messages=t},setRTMessages:function(e,t){if(t&&t.length){e.filter&&i&&(t=i(e.filter,t)),c(t);var r=e.messages;a&&a(t),r.splice.apply(r,[r.length,0].concat(M(t))),u(e,{type:"rt",count:t.length})}},prependMessages:function(e,t){if(t&&t.length){t.reverse();var r=e.messages;c(t),a&&a(t),r.splice.apply(r,[0,0].concat(M(t)))}},appendMessages:function(e,t){if(t&&t.length){var r=e.messages;c(t),a&&a(t),r.splice.apply(r,[r.length,0].concat(M(t)))}},clearMessages:l,setLimit:function(e,t){s.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&s.set(e,"filter",t)},limiting:u,setFrom:function(e,t){s.set(e,"from",t)},setTo:function(e,t){s.set(e,"to",t)},reqStart:function(){DEV&&console.log("Start Request Logs")},setReverse:function(e,t){s.set(e,"reverse",t)},clear:function(e){return t.apply(this,arguments)},setOrigin:function(e,t){s.set(e,"origin",t)},setCols:r,updateCols:r,setDefaultCols:function(e){r(e,D)},setMissingMessages:function(e,t){var r,n=t.data,s=t.index;n.forEach(function(e){e["x-flespi-status"]="missed"}),(r=e.messages).splice.apply(r,[s+1,0].concat(M(n)))},setSelected:function(e,t){s.set(e,"selected",t)},clearSelected:p,setItemDeletedStatus:function(e,t){s.set(e,"isItemDeleted",t)},setCid:function(e,t){s.set(e,"cid",t)}}}e.default=function(e){var t=e.Vue,r=e.LocalStorage,n=e.name,s=e.errorHandler,i=e.filterHandler,a=e.newMessagesInterseptor;return{namespaced:!0,state:{name:n,isLoading:!1,origin:"",messages:[],pages:[],filter:"",realtimeEnabled:!1,from:0,to:0,cid:null,limit:1e3,reverse:!1,cols:[],offline:!1,selected:[],isItemDeleted:!1},actions:w({Vue:t,LocalStorage:r,errorHandler:s}),mutations:S({Vue:t,LocalStorage:r,filterHandler:i,newMessagesInterseptor:a})}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=logs.js.map
