!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("core-js/modules/es6.regexp.replace"),require("@babel/runtime-corejs2/regenerator"),require("regenerator-runtime/runtime"),require("core-js/library/fn/array/is-array"),require("core-js/library/fn/array/from"),require("core-js/library/fn/is-iterable"),require("core-js/library/fn/promise"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.object.to-string"),require("core-js/modules/es6.regexp.match"),require("lodash/get")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","core-js/modules/es6.regexp.replace","@babel/runtime-corejs2/regenerator","regenerator-runtime/runtime","core-js/library/fn/array/is-array","core-js/library/fn/array/from","core-js/library/fn/is-iterable","core-js/library/fn/promise","core-js/modules/es6.regexp.split","core-js/modules/es6.regexp.to-string","core-js/modules/es6.object.to-string","core-js/modules/es6.regexp.match","lodash/get"],t):t((e=e||self).logs={},null,null,e._regeneratorRuntime,null,e.isArray$1,e.from,e.isIterable$1,e.promise$1,null,null,null,null,e._get)}(this,function(e,t,r,S,n,s,i,o,a,c,u,l,f,j){"use strict";S=S&&S.hasOwnProperty("default")?S.default:S,s=s&&s.hasOwnProperty("default")?s.default:s,i=i&&i.hasOwnProperty("default")?i.default:i,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a,j=j&&j.hasOwnProperty("default")?j.default:j;var d=s;var p=function(e){if(d(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}},m=i,g=o;var h=function(e){if(g(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return m(e)};var v=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var M=function(e){return p(e)||h(e)||v()},y=a;function w(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):y.resolve(c).then(n,s)}var L=function(a){return function(){var e=this,o=arguments;return new y(function(t,r){var n=a.apply(e,o);function s(e){w(n,t,r,s,i,"next",e)}function i(e){w(n,t,r,s,i,"throw",e)}s(void 0)})}},x=(new Date).toString().match(/([-+][0-9]+)\s/)[1],D=[{name:"timestamp",width:100,display:!0,description:"Log event time",addition:"".concat(x.slice(0,3),":").concat(x.slice(3))},{name:"event_code",title:"event",width:400,display:!0,description:"Log event code and description"},{name:"ident",width:150,display:!0,description:"Connected device's identification string"},{name:"msgs",width:85,display:!0,description:"Number of messages received"},{name:"recv",width:85,display:!0,description:"Number of bytes received"},{name:"send",width:85,display:!0,description:"Number of bytes sent"},{name:"source",width:150,display:!0,description:"Connected device's address"},{name:"host",width:150,display:!0,description:"IP address from which HTTP request was received"},{name:"duration",width:85,display:!0,description:"Connection duration in seconds"},{name:"transport",width:85,display:!0,description:"Connected device's transport: tcp, udp, http etc"},{name:"etc",width:150,display:!0,__dest:"etc"}];function b(e){var f=e.Vue,o=e.LocalStorage,d=e.errorHandler;function c(e){var t={filter:[]};return-1===e.origin.indexOf("platform")&&!e.isItemDeleted||t.filter.push("event_origin=".concat(e.origin)),e.limit&&(t.count=e.limit),e.filter&&0===e.mode&&t.filter.push("".concat(e.filter)),!e.from||e.reverse&&1!==e.mode||(e.reverse?1===e.mode&&(t.from=Math.floor(Date.now()/1e3-172800)):t.from=Math.floor(e.from/1e3)),e.to&&(1===e.mode&&(e.to=Date.now()),t.to=Math.floor(e.to/1e3)),e.reverse&&(t.reverse=e.reverse),t.filter.length?t.filter=t.filter.join(","):delete t.filter,t}function p(e){var t={};return e.cid&&(t["x-flespi-cid"]=e.cid),t}function m(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);d&&d(t)})}function g(e,t){var r=e.split("/"),n=r.pop(),s=t||"*"===e?f.connector.http.platform.customer:r.reduce(function(e,t){return e[t]},f.connector.http);return"*"===n||t?function(e){return s.logs.get({data:JSON.stringify(e.data)},{headers:e.headers})}:function(e){return s.logs.get(n,{data:JSON.stringify(e.data)},{headers:e.headers})}}function t(){return(t=L(S.mark(function e(n){var s,i,o,a,c,u,l;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.state,i=n.commit,n.rootState.token&&s.origin)return e.prev=2,f.set(s,"isLoading",!0),o={data:{reverse:!0,count:1,fields:"timestamp"},headers:p(s)},-1===s.origin.indexOf("platform")&&!s.isItemDeleted||(o.data.filter="event_origin=".concat(s.origin)),e.next=8,g(s.origin,s.isItemDeleted)(o);e.next=24;break;case 8:a=e.sent,m(c=a.data),u=Date.now(),c.result.length&&(u=Math.round(1e3*c.result[0].timestamp)),void 0,t=u||Date.now(),r=new Date(t).setHours(0,0,0,0),i("setFrom",(l={from:r,to:r+86399999}).from),i("setTo",l.to),f.set(s,"isLoading",!1),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(2),d&&d(e.t0),DEV&&console.log(e.t0),f.set(s,"isLoading",!1);case 24:case"end":return e.stop()}var t,r},e,null,[[2,19]])}))).apply(this,arguments)}function u(e,t){return r.apply(this,arguments)}function r(){return(r=L(S.mark(function e(t,r){var n,s,i,o,a,c;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,s=t.commit,i=t.rootState,s("reqStart"),i.token&&n.origin)return e.prev=3,f.set(n,"isLoading",!0),o=JSON.parse(JSON.stringify(n.mode)),e.next=8,g(n.origin,n.isItemDeleted)({data:r,headers:p(n)});e.next=22;break;case 8:if(a=e.sent,o!==n.mode)return e.abrupt("return",!1);e.next=11;break;case 11:return m(c=a.data),f.set(n,"isLoading",!1),e.abrupt("return",c.result);case 17:e.prev=17,e.t0=e.catch(3),d&&d(e.t0),DEV&&console.log(e.t0),f.set(n,"isLoading",!1);case 22:case"end":return e.stop()}},e,null,[[3,17]])}))).apply(this,arguments)}function l(e){return n.apply(this,arguments)}function n(){return(n=L(S.mark(function e(t){var r,n,s,i;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=t.commit,s=t.rootState,e.next=3,u({state:r,commit:n,rootState:s},c(r));case 3:i=e.sent,n("setMessages",i);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function s(){return(s=L(S.mark(function e(t,r){var n,s,i,o,a;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.state,s=t.commit,i=t.rootState,o=n.limit,a=n.filter,s("setReverse",!0),s("setLimit",r),s("setFilter",""),e.next=7,l({state:n,commit:s,rootState:i});case 7:s("setReverse",!1),s("setLimit",o),s("setFilter",a);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function i(){return(i=L(S.mark(function e(t){var r,n,s,i,o,a;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,s=t.rootState,r.isLoading){e.next=11;break}return i=Math.floor(j(r,"messages[0].timestamp",r.to)-1),(o=c(r)).to=i,o.reverse=!0,e.next=8,u({state:r,commit:n,rootState:s},o);case 8:return a=e.sent,n("prependMessages",a),e.abrupt("return",a.length);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function a(){return(a=L(S.mark(function e(t){var r,n,s,i,o,a;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,s=t.rootState,r.isLoading){e.next=10;break}return i=Math.floor(j(r,"messages[".concat(r.messages.length-1,"].timestamp"),r.from)+1),(o=c(r)).from=i,e.next=7,u({state:r,commit:n,rootState:s},o);case 7:return a=e.sent,n("appendMessages",a),e.abrupt("return",a.length);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}var h=[],v=0;function y(e,t){return setInterval(function(){h.length&&(1===e.mode&&t("setMessages",M(h)),h=[])},500)}function w(){return(w=L(S.mark(function e(t){var r,n,s,i,o;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=t.commit,t.rootState,s=r.origin.split("/")[0].replace(/\*/g,"+"),i=r.origin.replace("".concat(s,"/"),"").replace(/\*/g,"+"),v=y(r,n),o={},r.cid&&(o={userProperties:{cid:r.cid}}),e.next=7,f.connector.subscribeLogs(s,i,"#",function(e){1===r.mode&&h.push(JSON.parse(e))},{rh:2,properties:o});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(){return(x=L(S.mark(function e(t){var r,n,s,i,o,a;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,t.rootState.token&&r.origin)return e.prev=2,f.set(r,"isLoading",!0),s=r.messages.reduceRight(function(e,t,r){return e||("offline"===t.__connectionStatus&&(e=r),e)},0),i={data:{from:s?Math.floor(r.messages[s-1].timestamp)+1:0,to:Math.floor(r.messages[s+1].timestamp)},headers:p(r)},-1!==r.origin.indexOf("platform")&&(i.data.filter="event_origin=".concat(r.origin)),e.next=9,g(r.origin,r.isItemDeleted)(i);e.next=21;break;case 9:o=e.sent,m(a=o.data),n("setMissingMessages",{data:a.result,index:s}),f.set(r,"isLoading",!1),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(2),d&&d(e.t0),DEV&&console.log(e.t0),f.set(r,"isLoading",!1);case 21:case"end":return e.stop()}},e,null,[[2,16]])}))).apply(this,arguments)}function b(){return(b=L(S.mark(function e(t){var r,n,s,i;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=r.origin.split("/")[0].replace(/\*/g,"+"),s=r.origin.replace("".concat(n,"/"),"").replace(/\*/g,"+"),v&&clearInterval(v),i={},r.cid&&(i={userProperties:{cid:r.cid}}),e.next=7,f.connector.unsubscribeLogs(n,s,"#",void 0,{properties:i});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{getLogs:u,get:l,getPrevPage:function(e){return i.apply(this,arguments)},getNextPage:function(e){return a.apply(this,arguments)},pollingGet:function(e){return w.apply(this,arguments)},getHistory:function(e,t){return s.apply(this,arguments)},initTime:function(e){return t.apply(this,arguments)},getCols:function(e,t){var r=e.state,n=e.commit,s=(e.rootState,t||D),i=o.getItem(r.name);i&&i[r.origin]&&i[r.origin].length&&(i[r.origin].forEach(function(e){if("timestamp"===e.name){var t=(new Date).toString().match(/([-+][0-9]+)\s/)[1];e.addition="".concat(t.slice(0,3),":").concat(t.slice(3))}}),s=i[r.origin]),s[s.length-1].__dest||s.push({name:"etc",width:150,display:!0,__dest:"etc"}),n("setCols",s)},unsubscribePooling:function(e){return b.apply(this,arguments)},getMissedMessages:function(e){return x.apply(this,arguments)}}}function k(e){var s=e.Vue,n=e.LocalStorage,i=e.filterHandler,o=e.newMessagesInterseptor;function a(e){var t=e||Date.now(),r=new Date(t).setHours(0,0,0,0);return{from:r,to:r+864e5}}function r(e,t){1===e.mode?function(e,t){if(t&&t.length){e.reverse&&(t.reverse(),t[t.length-1].delimiter=!0),s.set(e,"from",Math.floor(1e3*(t[t.length-1].timestamp+1))),e.filter&&i&&(t=i(e.filter,t)),o&&o(t);var r=e.messages.concat(t);if(e.limit&&r.length>=e.limit+.1*e.limit){var n=r.length-1-(e.limit-1);r=r.slice(n),s.set(e,"selected",e.selected.map(function(e){return e-n}))}s.set(e,"messages",r)}else s.set(e,"from",e.to+1e3)}(e,t):function(e,t){if(t&&t.length){e.reverse&&t.reverse();var r=e.messages;r=r.concat(t),o&&o(t),s.set(e,"messages",r)}else s.set(e,"messages",[])}(e,t)}function c(e){o&&o([]),s.set(e,"messages",[]),l(e)}function t(){return(t=L(S.mark(function e(t){var r,n;return S.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.origin.split("/")[0],n=t.origin.replace("".concat(r,"/"),"").replace(/\*/g,"+"),c(t),t.filter="",t.mode=null,t.from=0,t.to=0,t.limit=1e3,t.reverse=!1,e.next=10,s.connector.unsubscribeLogs(r,n,"#");case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function u(e,t){var r=n.getItem(e.name);(r=r||{})[e.origin]=t,n.set(e.name,r),s.set(e,"cols",t)}function l(e){s.set(e,"selected",[])}return{setOffline:function(e,t){t&&r(e,[{__connectionStatus:"offline",timestamp:Date.now()/1e3}]),e.offline=!0},setReconnected:function(e,t){t&&r(e,[{__connectionStatus:"reconnected",timestamp:Date.now()/1e3}]),e.offline=!1},setMessages:r,prependMessages:function(e,t){if(t&&t.length){t.reverse();var r=e.messages;if(o&&o(t),r.splice.apply(r,[0,0].concat(M(t))),e.limit&&3*e.limit<r.length){var n=3*e.limit,s=r.length-n;r.splice(r.length-s,s)}}},appendMessages:function(e,t){if(t&&t.length){var r=e.messages;if(o&&o(t),r.splice.apply(r,[r.length,0].concat(M(t))),e.limit&&3*e.limit<r.length){var n=3*e.limit;r.splice(0,r.length-n)}}},clearMessages:c,setLimit:function(e,t){s.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&(1===e.mode&&(e.filter&&e.messages.push({"x-flespi-filter-prev":e.filter}),t&&e.messages.push({"x-flespi-filter-next":t})),s.set(e,"filter",t))},setMode:function(e,t){switch(t){case 0:var r=e.from?a(e.from):a();e.from=r.from,e.to=r.to,c(e);break;case 1:var n=Date.now()-6e3;e.from=n-1e3,e.to=n}s.set(e,"mode",t)},setFrom:function(e,t){s.set(e,"from",t)},setTo:function(e,t){s.set(e,"to",t)},reqStart:function(){DEV&&console.log("Start Request Logs")},setReverse:function(e,t){s.set(e,"reverse",t)},clear:function(e){return t.apply(this,arguments)},setOrigin:function(e,t){s.set(e,"origin",t)},setCols:u,updateCols:u,setDefaultCols:function(e){u(e,D)},setMissingMessages:function(e,t){var r,n=t.data,s=t.index;n.forEach(function(e){e.__status="missed"}),(r=e.messages).splice.apply(r,[s+1,0].concat(M(n)))},setSelected:function(e,t){s.set(e,"selected",t)},clearSelected:l,setItemDeletedStatus:function(e,t){s.set(e,"isItemDeleted",t)},setCid:function(e,t){s.set(e,"cid",t)}}}e.default=function(e){var t=e.Vue,r=e.LocalStorage,n=e.name,s=e.errorHandler,i=e.filterHandler,o=e.newMessagesInterseptor;return{namespaced:!0,state:{name:n,isLoading:!1,origin:"",messages:[],filter:"",mode:null,from:0,to:0,cid:null,limit:1e3,reverse:!1,cols:[],offline:!1,selected:[],isItemDeleted:!1},actions:b({Vue:t,LocalStorage:r,errorHandler:s}),mutations:k({Vue:t,LocalStorage:r,filterHandler:i,newMessagesInterseptor:o})}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=logs.js.map
