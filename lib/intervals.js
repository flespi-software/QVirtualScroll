!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("core-js/modules/es6.regexp.split"),require("@babel/runtime-corejs2/regenerator"),require("regenerator-runtime/runtime"),require("core-js/library/fn/array/is-array"),require("core-js/library/fn/array/from"),require("core-js/library/fn/is-iterable")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","core-js/modules/es6.regexp.split","@babel/runtime-corejs2/regenerator","regenerator-runtime/runtime","core-js/library/fn/array/is-array","core-js/library/fn/array/from","core-js/library/fn/is-iterable"],t):t((e=e||self).intervals={},null,null,e._regeneratorRuntime,null,e.isArray$1,e.from,e.isIterable$1)}(this,function(e,t,r,v,n,s,a,i){"use strict";function l(e){var u=e.Vue,a=e.LocalStorage,f=e.errorHandler;function d(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);f&&f(t)})}return{get:function(n){var s,a,i,o,c;return v.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.state,a=n.commit,i=n.rootState,a("reqStart"),i.token&&s.active&&s.activeDevice)return e.prev=3,u.set(s,"isLoading",!0),e.next=7,v.awrap(u.connector.gw.getCalcsDevicesIntervals(s.active,s.activeDevice,"all",{data:JSON.stringify((t=s,r=void 0,r={},t.limit&&(r.count=t.limit),t.filter&&t.sysFilter?r.filter="".concat(t.sysFilter,",").concat(t.filter):t.sysFilter&&!t.filter?r.filter="".concat(t.sysFilter):!t.sysFilter&&t.filter&&(r.filter="".concat(t.filter)),t.begin&&!t.reverse&&(t.reverse||(r.begin=Math.floor(t.begin/1e3))),t.end&&(r.end=Math.floor(t.end/1e3)),t.reverse&&(r.reverse=t.reverse),r))}));e.next=19;break;case 7:o=e.sent,d(c=o.data),a("setMessages",c.result),u.set(s,"isLoading",!1),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(3),f&&f(e.t0),DEV&&console.log(e.t0),u.set(s,"isLoading",!1);case 19:case"end":return e.stop()}var t,r},null,null,[[3,14]])},pollingGet:function(t){var l;return v.async(function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.state,t.commit,e.next=3,v.awrap(u.connector.subscribeIntervals(l.active,l.activeDevice,"+",function(e,t){switch(e=JSON.parse(e),t.split("/").slice(-1)[0]){case"created":var r=l.begin,n=l.end,s=new Date(n),a=1e3*e.begin,i=1e3*e.end,o=new Date,c=s.getDate()===o.getDate()&&s.getMonth()===o.getMonth()&&s.getFullYear()===o.getFullYear();(a<=n&&r<=i||c)&&u.set(l.messages,e.id,e);break;case"updated":case"finished":l.messages[e.id]&&u.set(l.messages,e.id,e);break;case"deleted":l.messages[e.id]&&u.delete(l.messages,e.id)}},{rh:2}));case 3:case"end":return e.stop()}})},initTime:function(t){var r,n,s,a,i,o,c,l;return v.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,t.rootState.token&&r.active&&r.activeDevice)return e.prev=2,u.set(r,"isLoading",!0),s={reverse:!0,count:1,fields:"end"},e.next=7,v.awrap(u.connector.gw.getCalcsDevicesIntervals(r.active,r.activeDevice,"all",{data:JSON.stringify(s)}));e.next=26;break;case 7:a=e.sent,d(i=a.data),o=Date.now(),i.result.length&&(o=Math.round(1e3*i.result[0].end)),(c=new Date(o)).setHours(0,0,0,0),(l=new Date(o)).setHours(23,59,59,999),n("setBegin",c.valueOf()),n("setEnd",l.valueOf()),u.set(r,"isLoading",!1),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(2),f&&f(e.t0),DEV&&console.log(e.t0),u.set(r,"isLoading",!1);case 26:case"end":return e.stop()}},null,null,[[2,21]])},unsubscribePooling:function(t){var r;return v.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,e.next=3,v.awrap(u.connector.unsubscribeIntervals(r.active,r.activeDevice,"+"));case 3:case"end":return e.stop()}})},getCols:function(e,t){var r=e.state,n=e.commit,s=a.getItem(r.name);s&&s[r.active]&&s[r.active].length?n("updateCols",s[r.active]):n("setCols",t)}}}v=v&&v.hasOwnProperty("default")?v.default:v,s=s&&s.hasOwnProperty("default")?s.default:s,a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i;var o=s;var c=function(e){if(o(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}},u=a,f=i;var d=function(e){if(f(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return u(e)};var g=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var m=function(e){return c(e)||d(e)||g()};function p(e){var a=e.Vue,i=e.LocalStorage,n=(e.filterHandler,e.newMessagesInterseptor);function r(e){a.set(e,"messages",[]),n&&n([]),t(e)}function t(e){a.set(e,"selected",[])}return{setMessages:function(e,t){if(t&&t.length){e.reverse&&t.reverse();var r=e.messages;n&&n(t),r=t.reduce(function(e,t){return e[t.id]=t,e},{}),a.set(e,"messages",r)}else a.set(e,"messages",[])},clearMessages:r,setLimit:function(e,t){a.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&a.set(e,"filter",t)},setBegin:function(e,t){a.set(e,"begin",t)},setEnd:function(e,t){a.set(e,"end",t)},reqStart:function(){DEV&&console.log("Start Request intervals messages")},setReverse:function(e,t){a.set(e,"reverse",t)},clear:function(t){return v.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r(t),t.filter="",t.begin=0,t.end=0,t.limit=1e3,t.reverse=!1,e.next=8,v.awrap(a.connector.unsubscribeIntervals(t.active));case 8:case"end":return e.stop()}})},setActive:function(e,t){e.newMessagesCount=0,a.set(e,"active",t)},setCols:function(e,t){var r=[{name:"begin",title:"begin",width:170,display:!0,description:"Begin of interval"},{name:"end",width:170,display:!0,description:"End of interval"},{name:"duration",width:85,display:!0,description:"Duration of interval"},{name:"timestamp",width:170,display:!0,description:"Interval timestamp"},{name:"id",width:50,display:!0,description:"ID of interval"}],n=t.map(function(e){return e.width=100,e.display=!0,e.description="".concat(e.name,"[").concat(e.type,"]"),e});r=[].concat(m(r),m(n));var s=i.getItem(e.name);(s=s||{})[e.active]=r,i.set(e.name,s),a.set(e,"cols",r)},updateCols:function(e,t){var r=i.getItem(e.name);(r=r||{})[e.active]=t,i.set(e.name,r),a.set(e,"cols",t)},setSelected:function(e,t){a.set(e,"selected",t)},clearSelected:t,setSortBy:function(e,t){a.set(e,"sortBy",t)},clearSortBy:function(e){a.set(e,"sortBy",null)},setActiveDevice:function(e,t){a.set(e,"activeDevice",t)}}}e.default=function(e){var t=e.Vue,r=e.LocalStorage,n=e.name,s=e.errorHandler,a=e.filterHandler,i=e.newMessagesInterseptor,o=l({Vue:t,LocalStorage:r,errorHandler:s}),c=p({Vue:t,LocalStorage:r,filterHandler:a,newMessagesInterseptor:i});return{namespaced:!0,state:{name:n,isLoading:!1,active:0,activeDevice:0,messages:{},filter:"",sysFilter:"",begin:Date.now()-864e5,end:Date.now(),limit:1e3,reverse:!1,cols:[],selected:[],sortBy:null},actions:o,mutations:c}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=intervals.js.map
