!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("@babel/runtime-corejs2/regenerator"),require("regenerator-runtime/runtime"),require("core-js/modules/es6.regexp.split"),require("core-js/library/fn/promise"),require("core-js/library/fn/array/is-array"),require("core-js/library/fn/array/from"),require("core-js/library/fn/is-iterable")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","@babel/runtime-corejs2/regenerator","regenerator-runtime/runtime","core-js/modules/es6.regexp.split","core-js/library/fn/promise","core-js/library/fn/array/is-array","core-js/library/fn/array/from","core-js/library/fn/is-iterable"],t):t((e=e||self).intervals={},null,e._regeneratorRuntime,null,null,e.promise$1,e.isArray$1,e.from,e.isIterable$1)}(this,function(e,t,v,r,n,a,s,i,o){"use strict";v=v&&v.hasOwnProperty("default")?v.default:v,a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s,i=i&&i.hasOwnProperty("default")?i.default:i,o=o&&o.hasOwnProperty("default")?o.default:o;var l=a;function c(e,t,r,n,a,s,i){try{var o=e[s](i),c=o.value}catch(e){return void r(e)}o.done?t(c):l.resolve(c).then(n,a)}var p=function(o){return function(){var e=this,i=arguments;return new l(function(t,r){var n=o.apply(e,i);function a(e){c(n,t,r,a,s,"next",e)}function s(e){c(n,t,r,a,s,"throw",e)}a(void 0)})}};function u(e){var u=e.Vue,s=e.LocalStorage,f=e.errorHandler;function d(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);f&&f(t)})}function t(){return(t=p(v.mark(function e(t){var r,n,a,s,i,o,c,l;return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.commit,t.rootState.token&&r.active&&r.activeDevice)return e.prev=2,u.set(r,"isLoading",!0),a={reverse:!0,count:1,fields:"end"},e.next=7,u.connector.gw.getCalcsDevicesIntervals(r.active,r.activeDevice,"all",{data:JSON.stringify(a)});e.next=26;break;case 7:s=e.sent,d(i=s.data),o=Date.now(),i.result.length&&(o=Math.round(1e3*i.result[0].end)),(c=new Date(o)).setHours(0,0,0,0),(l=new Date(o)).setHours(23,59,59,999),n("setBegin",c.valueOf()),n("setEnd",l.valueOf()),u.set(r,"isLoading",!1),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(2),f&&f(e.t0),DEV&&console.log(e.t0),u.set(r,"isLoading",!1);case 26:case"end":return e.stop()}},e,null,[[2,21]])}))).apply(this,arguments)}function r(){return(r=p(v.mark(function e(n){var a,s,i,o,c;return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state,s=n.commit,i=n.rootState,s("reqStart"),i.token&&a.active&&a.activeDevice)return e.prev=3,u.set(a,"isLoading",!0),e.next=7,u.connector.gw.getCalcsDevicesIntervals(a.active,a.activeDevice,"all",{data:JSON.stringify((r=void 0,r={},(t=a).limit&&(r.count=t.limit),t.filter&&t.sysFilter?r.filter="".concat(t.sysFilter,",").concat(t.filter):t.sysFilter&&!t.filter?r.filter="".concat(t.sysFilter):!t.sysFilter&&t.filter&&(r.filter="".concat(t.filter)),t.begin&&!t.reverse&&(t.reverse||(r.begin=Math.floor(t.begin/1e3))),t.end&&(r.end=Math.floor(t.end/1e3)),t.reverse&&(r.reverse=t.reverse),r))});e.next=19;break;case 7:o=e.sent,d(c=o.data),s("setMessages",c.result),u.set(a,"isLoading",!1),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(3),f&&f(e.t0),DEV&&console.log(e.t0),u.set(a,"isLoading",!1);case 19:case"end":return e.stop()}var t,r},e,null,[[3,14]])}))).apply(this,arguments)}var n=function(e,t){var r=JSON.parse(t.payload);switch(t.topic.split("/").slice(-1)[0]){case"created":var n=e.begin,a=e.end,s=new Date(a),i=1e3*r.begin,o=1e3*r.end,c=new Date,l=s.getDate()===c.getDate()&&s.getMonth()===c.getMonth()&&s.getFullYear()===c.getFullYear();(i<=a&&n<=o||l)&&u.set(e.messages,r.id,r);break;case"updated":case"finished":e.messages[r.id]&&u.set(e.messages,r.id,r);break;case"deleted":e.messages[r.id]&&u.delete(e.messages,r.id)}},a=[],i=0;function o(t){return setInterval(function(){a.length&&(a.forEach(function(e){return n(t,e)}),a=[])},500)}function c(){return(c=p(v.mark(function e(t){var r;return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,t.commit,i=o(r),e.next=4,u.connector.subscribeIntervals(r.active,r.activeDevice,"+",function(e,t,r){a.push(r)},{rh:2});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function l(){return(l=p(v.mark(function e(t){var r;return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,i&&clearInterval(i),e.next=4,u.connector.unsubscribeIntervals(r.active,r.activeDevice,"+");case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{get:function(e){return r.apply(this,arguments)},pollingGet:function(e){return c.apply(this,arguments)},initTime:function(e){return t.apply(this,arguments)},unsubscribePooling:function(e){return l.apply(this,arguments)},getCols:function(e,t){var r=e.state,n=e.commit,a=s.getItem(r.name);a&&a[r.active]&&a[r.active].length?n("updateCols",a[r.active]):n("setCols",t)}}}var f=s;var d=function(e){if(f(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}},g=i,m=o;var y=function(e){if(m(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return g(e)};var h=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var b=function(e){return d(e)||y(e)||h()};function w(e){var s=e.Vue,i=e.LocalStorage,n=(e.filterHandler,e.newMessagesInterseptor);function r(e){s.set(e,"messages",[]),n&&n([]),a(e)}function t(){return(t=p(v.mark(function e(t){return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r(t),t.filter="",t.begin=0,t.end=0,t.limit=1e3,t.reverse=!1,e.next=8,s.connector.unsubscribeIntervals(t.active);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function a(e){s.set(e,"selected",[])}return{setMessages:function(e,t){if(t&&t.length){e.reverse&&t.reverse();var r=e.messages;n&&n(t),r=t.reduce(function(e,t){return e[t.id]=t,e},{}),s.set(e,"messages",r)}else s.set(e,"messages",[])},clearMessages:r,setLimit:function(e,t){s.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&s.set(e,"filter",t)},setBegin:function(e,t){s.set(e,"begin",t)},setEnd:function(e,t){s.set(e,"end",t)},reqStart:function(){DEV&&console.log("Start Request intervals messages")},setReverse:function(e,t){s.set(e,"reverse",t)},clear:function(e){return t.apply(this,arguments)},setActive:function(e,t){e.newMessagesCount=0,s.set(e,"active",t)},setCols:function(e,t){var r=[{name:"begin",title:"begin",width:170,display:!0,description:"Begin of interval"},{name:"end",width:170,display:!0,description:"End of interval"},{name:"duration",width:85,display:!0,description:"Duration of interval"},{name:"timestamp",width:170,display:!0,description:"Interval timestamp"},{name:"id",width:50,display:!0,description:"ID of interval"}],n=t.map(function(e){return e.width=100,e.display=!0,e.description="".concat(e.name,"[").concat(e.type,"]"),e});r=[].concat(b(r),b(n));var a=i.getItem(e.name);(a=a||{})[e.active]=r,i.set(e.name,a),s.set(e,"cols",r)},updateCols:function(e,t){var r=i.getItem(e.name);(r=r||{})[e.active]=t,i.set(e.name,r),s.set(e,"cols",t)},setSelected:function(e,t){s.set(e,"selected",t)},clearSelected:a,setSortBy:function(e,t){s.set(e,"sortBy",t)},clearSortBy:function(e){s.set(e,"sortBy",null)},setActiveDevice:function(e,t){s.set(e,"activeDevice",t)}}}e.default=function(e){var t=e.Vue,r=e.LocalStorage,n=e.name,a=e.errorHandler,s=e.filterHandler,i=e.newMessagesInterseptor,o=u({Vue:t,LocalStorage:r,errorHandler:a}),c=w({Vue:t,LocalStorage:r,filterHandler:s,newMessagesInterseptor:i});return{namespaced:!0,state:{name:n,isLoading:!1,active:0,activeDevice:0,messages:{},filter:"",sysFilter:"",begin:Date.now()-864e5,end:Date.now(),limit:1e3,reverse:!1,cols:[],selected:[],sortBy:null},actions:o,mutations:c}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=intervals.js.map
