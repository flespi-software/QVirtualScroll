!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es6.function.name"),require("core-js/modules/es6.regexp.split"),require("regenerator-runtime/runtime"),require("@babel/runtime/helpers/asyncToGenerator"),require("@babel/runtime/helpers/toConsumableArray")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es6.function.name","core-js/modules/es6.regexp.split","regenerator-runtime/runtime","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/helpers/toConsumableArray"],t):t((e=e||self).intervals={},null,null,null,e._asyncToGenerator,e._toConsumableArray)}(this,function(e,t,n,r,u,l){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u,l=l&&l.hasOwnProperty("default")?l.default:l,e.default=function(e){var t=e.Vue,n=e.LocalStorage,r=e.name,s=e.errorHandler,i=e.filterHandler,a=e.newMessagesInterseptor,o=function(e){var l=e.Vue,i=e.LocalStorage,f=e.errorHandler;function d(e){e.errors&&e.errors.forEach(function(e){var t=new Error(e.reason);f&&f(t)})}function t(){return(t=u(regeneratorRuntime.mark(function e(t){var n,r,s,i,a,o,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,r=t.commit,t.rootState.token&&n.active&&n.activeDevice)return e.prev=2,l.set(n,"isLoading",!0),s={reverse:!0,count:1,fields:"end"},e.next=7,l.connector.gw.getCalcsDevicesIntervals(n.active,n.activeDevice,"all",{data:JSON.stringify(s)});e.next=26;break;case 7:i=e.sent,d(a=i.data),o=Date.now(),a.result.length&&(o=Math.round(1e3*a.result[0].end)),(c=new Date(o)).setHours(0,0,0,0),(u=new Date(o)).setHours(23,59,59,999),r("setBegin",c.valueOf()),r("setEnd",u.valueOf()),l.set(n,"isLoading",!1),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(2),f&&f(e.t0),DEV&&console.log(e.t0),l.set(n,"isLoading",!1);case 26:case"end":return e.stop()}},e,null,[[2,21]])}))).apply(this,arguments)}function n(){return(n=u(regeneratorRuntime.mark(function e(r){var s,i,a,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.state,i=r.commit,a=r.rootState,i("reqStart"),a.token&&s.active&&s.activeDevice)return e.prev=3,l.set(s,"isLoading",!0),e.next=7,l.connector.gw.getCalcsDevicesIntervals(s.active,s.activeDevice,"all",{data:JSON.stringify((t=s,n=void 0,n={},t.limit&&(n.count=t.limit),t.filter&&t.sysFilter?n.filter="".concat(t.sysFilter,",").concat(t.filter):t.sysFilter&&!t.filter?n.filter="".concat(t.sysFilter):!t.sysFilter&&t.filter&&(n.filter="".concat(t.filter)),t.begin&&!t.reverse&&(t.reverse||(n.begin=Math.floor(t.begin/1e3))),t.end&&(n.end=Math.floor(t.end/1e3)),t.reverse&&(n.reverse=t.reverse),n))});e.next=19;break;case 7:o=e.sent,d(c=o.data),i("setMessages",c.result),l.set(s,"isLoading",!1),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(3),f&&f(e.t0),DEV&&console.log(e.t0),l.set(s,"isLoading",!1);case 19:case"end":return e.stop()}var t,n},e,null,[[3,14]])}))).apply(this,arguments)}function r(){return(r=u(regeneratorRuntime.mark(function e(t){var u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.state,t.commit,e.next=3,l.connector.subscribeIntervals(u.active,u.activeDevice,"+",function(e,t){switch(e=JSON.parse(e),t.split("/").slice(-1)[0]){case"created":var n=u.begin,r=u.end,s=new Date(r),i=1e3*e.begin,a=1e3*e.end,o=new Date,c=s.getDate()===o.getDate()&&s.getMonth()===o.getMonth()&&s.getFullYear()===o.getFullYear();(i<=r&&n<=a||c)&&l.set(u.messages,e.id,e);break;case"updated":case"finished":u.messages[e.id]&&l.set(u.messages,e.id,e);break;case"deleted":u.messages[e.id]&&l.delete(u.messages,e.id)}},{rh:2});case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function s(){return(s=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.state,e.next=3,l.connector.unsubscribeIntervals(n.active,n.activeDevice,"+");case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{get:function(e){return n.apply(this,arguments)},pollingGet:function(e){return r.apply(this,arguments)},initTime:function(e){return t.apply(this,arguments)},unsubscribePooling:function(e){return s.apply(this,arguments)},getCols:function(e,t){var n=e.state,r=e.commit,s=i.get.item(n.name);s&&s[n.active]&&s[n.active].length?r("updateCols",s[n.active]):r("setCols",t)}}}({Vue:t,LocalStorage:n,errorHandler:s}),c=function(e){var i=e.Vue,a=e.LocalStorage,r=(e.filterHandler,e.newMessagesInterseptor);function n(e){i.set(e,"messages",[]),r&&r([]),s(e)}function t(){return(t=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n(t),t.filter="",t.begin=0,t.end=0,t.limit=1e3,t.reverse=!1,e.next=8,i.connector.unsubscribeIntervals(t.active);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function s(e){i.set(e,"selected",[])}return{setMessages:function(e,t){if(t&&t.length){e.reverse&&t.reverse();var n=e.messages;r&&r(t),n=t.reduce(function(e,t){return e[t.id]=t,e},{}),i.set(e,"messages",n)}else i.set(e,"messages",[])},clearMessages:n,setLimit:function(e,t){i.set(e,"limit",t)},setFilter:function(e,t){e.filter!==t&&i.set(e,"filter",t)},setBegin:function(e,t){i.set(e,"begin",t)},setEnd:function(e,t){i.set(e,"end",t)},reqStart:function(){DEV&&console.log("Start Request intervals messages")},setReverse:function(e,t){i.set(e,"reverse",t)},clear:function(e){return t.apply(this,arguments)},setActive:function(e,t){e.newMessagesCount=0,i.set(e,"active",t)},setCols:function(e,t){var n=[{name:"begin",title:"begin",width:170,display:!0,description:"Begin of interval"},{name:"end",width:170,display:!0,description:"End of interval"},{name:"duration",width:85,display:!0,description:"Duration of interval"},{name:"timestamp",width:170,display:!0,description:"Interval timestamp"},{name:"id",width:50,display:!0,description:"ID of interval"}],r=t.map(function(e){return e.width=100,e.display=!0,e.description="".concat(e.name,"[").concat(e.type,"]"),e});n=[].concat(l(n),l(r));var s=a.get.item(e.name);s||(s={}),s[e.active]=n,a.set(e.name,s),i.set(e,"cols",n)},updateCols:function(e,t){var n=a.get.item(e.name);n||(n={}),n[e.active]=t,a.set(e.name,n),i.set(e,"cols",t)},setSelected:function(e,t){i.set(e,"selected",t)},clearSelected:s,setSortBy:function(e,t){i.set(e,"sortBy",t)},clearSortBy:function(e){i.set(e,"sortBy",null)},setActiveDevice:function(e,t){i.set(e,"activeDevice",t)}}}({Vue:t,LocalStorage:n,filterHandler:i,newMessagesInterseptor:a});return{namespaced:!0,state:{name:r,isLoading:!1,active:0,activeDevice:0,messages:{},filter:"",sysFilter:"",begin:Date.now()-864e5,end:Date.now(),limit:1e3,reverse:!1,cols:[],selected:[],sortBy:null},actions:o,mutations:c}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=intervals.js.map
